<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f0f23">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <title>Trading Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #fff;
            padding-bottom: 80px;
        }

        .header {
            background: #0f0f23;
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #57f287;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            margin: 0;
            color: #57f287;
            font-size: 24px;
        }

        .nav-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #0f0f23;
            display: flex;
            border-top: 2px solid #57f287;
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: transparent;
            border: none;
            color: #888;
            font-size: 11px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .nav-item.active {
            color: #57f287;
            background: rgba(87, 242, 135, 0.1);
        }

        .nav-icon {
            font-size: 20px;
        }

        .page {
            display: none;
            padding: 20px;
        }

        .page.active {
            display: block;
        }

        .btn-primary {
            background: #57f287;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            width: 100%;
            margin-bottom: 15px;
        }

        .caixa {
            background: #16213e;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 5px solid #57f287;
        }

        .label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .valor {
            font-size: 28px;
            font-weight: bold;
        }

        .verde { color: #57f287; }
        .vermelho { color: #ed4245; }
        .azul { color: #5865f2; }

        .item-trade {
            background: #16213e;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
        }

        .trade-topo {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .ticker {
            font-size: 20px;
            font-weight: bold;
            color: #57f287;
        }

        .resultado {
            font-size: 22px;
            font-weight: bold;
        }

        .info {
            font-size: 14px;
            color: #aaa;
            margin: 5px 0;
        }

        .tipo {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        .compra {
            background: rgba(87, 242, 135, 0.2);
            color: #57f287;
        }

        .venda {
            background: rgba(237, 66, 69, 0.2);
            color: #ed4245;
        }

        .btn-excluir {
            background: #ed4245;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 10px;
            margin-right: 10px;
            font-size: 14px;
        }

        .btn-editar {
            background: #5865f2;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.visivel {
            display: block;
        }

        .modal-box {
            background: #16213e;
            border-radius: 15px;
            padding: 25px;
            max-width: 500px;
            margin: 0 auto;
        }

        .modal h2 {
            color: #57f287;
            margin: 0 0 20px 0;
            font-size: 22px;
        }

        .grupo {
            margin-bottom: 15px;
        }

        .grupo label {
            display: block;
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .grupo input,
        .grupo select,
        .grupo textarea {
            width: 100%;
            padding: 12px;
            background: #0f0f23;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            box-sizing: border-box;
        }

        .grupo textarea {
            min-height: 70px;
            font-family: Arial, sans-serif;
        }

        .botoes {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
        }

        .btn-cancelar {
            background: #333;
            color: #fff;
        }

        .btn-salvar {
            background: #57f287;
            color: #000;
        }

        .vazio {
            text-align: center;
            padding: 50px 20px;
            color: #666;
            font-size: 16px;
        }

        .oculto {
            display: none;
        }

        .grafico-mensal {
            background: #16213e;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
        }

        .grafico-titulo {
            font-size: 18px;
            font-weight: bold;
            color: #57f287;
            margin-bottom: 15px;
        }

        .calendario {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .dia-semana {
            text-align: center;
            font-size: 11px;
            color: #888;
            padding: 5px;
            font-weight: bold;
        }

        .dia {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            font-size: 12px;
            padding: 5px;
        }

        .dia-numero {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .dia-valor {
            font-size: 10px;
            font-weight: bold;
        }

        .dia-positivo {
            background: rgba(87, 242, 135, 0.3);
            border: 1px solid #57f287;
        }

        .dia-negativo {
            background: rgba(237, 66, 69, 0.3);
            border: 1px solid #ed4245;
        }

        .dia-neutro {
            background: #0f0f23;
            border: 1px solid #333;
            color: #666;
        }

        .resumo-periodo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .resumo-item {
            background: #0f0f23;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .resumo-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 5px;
        }

        .resumo-valor {
            font-size: 18px;
            font-weight: bold;
        }

        .calc-resultado {
            background: #16213e;
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
            border: 2px solid #57f287;
        }

        .calc-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #333;
        }

        .calc-item:last-child {
            border-bottom: none;
        }

        .calc-label {
            color: #aaa;
            font-size: 14px;
        }

        .calc-valor {
            font-weight: bold;
            font-size: 16px;
            color: #57f287;
        }

        .dca-entrada {
            background: #0f0f23;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 3px solid #5865f2;
        }

        .dca-entrada-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .entrada-numero {
            font-weight: bold;
            color: #5865f2;
        }

        .btn-remover {
            background: #ed4245;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
        }

        .btn-adicionar {
            background: #5865f2;
            color: #fff;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            width: 100%;
            margin-bottom: 20px;
        }

        .tabs-calc {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-calc {
            flex: 1;
            padding: 12px;
            background: #16213e;
            border: none;
            color: #888;
            font-size: 14px;
            font-weight: bold;
            border-radius: 8px;
        }

        .tab-calc.active {
            background: #57f287;
            color: #000;
        }
    </style>
</head>
<body>

<div class="header">
    <h1>üìä TRADING PRO</h1>
    <div style="margin-top: 10px;">
        <select id="moeda-select" onchange="mudarMoeda()" style="background: #16213e; color: #57f287; border: 1px solid #57f287; padding: 8px 15px; border-radius: 5px; font-weight: bold; font-size: 14px;">
            <option value="$">$ USD</option>
            <option value="‚Ç¨">‚Ç¨ EUR</option>
        </select>
    </div>
</div>

<!-- P√ÅGINA JOURNAL -->
<div id="page-journal" class="page active">
    <button class="btn-primary" onclick="abrirModal()">+ NOVO TRADE</button>
    <div id="grafico-mes"></div>
    <div id="estatisticas"></div>
</div>

<!-- P√ÅGINA HIST√ìRICO -->
<div id="page-historico" class="page">
    <div id="lista-trades"></div>
</div>

<!-- P√ÅGINA CALCULADORAS -->
<div id="page-calc" class="page">
    <div class="tabs-calc">
        <button class="tab-calc active" onclick="mudarCalc('risco')">Risco</button>
        <button class="tab-calc" onclick="mudarCalc('dca')">DCA</button>
    </div>

    <!-- CALCULADORA DE RISCO -->
    <div id="calc-risco" class="calc-content">
        <div class="caixa">
            <div class="label">CALCULADORA DE RISCO</div>
        </div>

        <div class="grupo">
            <label>Capital Dispon√≠vel (<span id="moeda-risco">$</span>)</label>
            <input type="number" id="capital" step="0.01" placeholder="10000" oninput="calcularRisco()">
        </div>

        <div class="grupo">
            <label>% Risco por Trade</label>
            <input type="number" id="risco-percent" step="0.1" placeholder="2" oninput="calcularRisco()">
        </div>

        <div class="grupo">
            <label>Pre√ßo de Entrada (<span id="moeda-risco2">$</span>)</label>
            <input type="number" id="preco-entrada-risco" step="0.01" placeholder="50.00" oninput="calcularRisco()">
        </div>

        <div class="grupo">
            <label>Stop Loss (%)</label>
            <input type="number" id="stop-loss-percent" step="0.1" placeholder="5" oninput="calcularRisco()">
        </div>

        <div class="grupo">
            <label>Take Profit (%)</label>
            <input type="number" id="take-profit-percent" step="0.1" placeholder="10" oninput="calcularRisco()">
        </div>

        <div id="resultado-risco"></div>
    </div>

    <!-- CALCULADORA DCA -->
    <div id="calc-dca" class="calc-content oculto">
        <div class="caixa">
            <div class="label">CALCULADORA DCA</div>
        </div>

        <button class="btn-adicionar" onclick="adicionarEntradaDCA()">+ Adicionar Entrada</button>

        <div id="entradas-dca"></div>

        <div class="grupo">
            <label>Pre√ßo Alvo Desejado (<span id="moeda-dca">$</span>)</label>
            <input type="number" id="preco-alvo" step="0.01" placeholder="45.00" oninput="calcularDCA()">
        </div>

        <div id="resultado-dca"></div>
    </div>
</div>

<!-- NAVEGA√á√ÉO INFERIOR -->
<div class="nav-bottom">
    <button class="nav-item active" onclick="mudarPagina('journal')">
        <div class="nav-icon">üìä</div>
        <div>Journal</div>
    </button>
    <button class="nav-item" onclick="mudarPagina('historico')">
        <div class="nav-icon">üìÖ</div>
        <div>Hist√≥rico</div>
    </button>
    <button class="nav-item" onclick="mudarPagina('calc')">
        <div class="nav-icon">üßÆ</div>
        <div>Calculadoras</div>
    </button>
</div>

<!-- MODAL NOVO TRADE -->
<div id="modal" class="modal">
    <div class="modal-box">
        <h2>Novo Trade</h2>
        <form id="formulario">
            <div class="grupo">
                <label>Ativo</label>
                <input type="text" id="ativo" required placeholder="Ex: AAPL">
            </div>

            <div class="grupo">
                <label>Tipo</label>
                <select id="tipo" required>
                    <option value="COMPRA">Compra</option>
                    <option value="VENDA">Venda</option>
                </select>
            </div>

            <div class="grupo">
                <label>Data Entrada</label>
                <input type="date" id="dataEntrada" required>
            </div>

            <div class="grupo">
                <label>Data Sa√≠da</label>
                <input type="date" id="dataSaida" required>
            </div>

            <div class="grupo">
                <label>Pre√ßo Entrada (<span id="moeda-form1">$</span>)</label>
                <input type="number" step="0.01" id="precoEntrada" required placeholder="0.00">
            </div>

            <div class="grupo">
                <label>Pre√ßo Sa√≠da (<span id="moeda-form2">$</span>)</label>
                <input type="number" step="0.01" id="precoSaida" required placeholder="0.00">
            </div>

            <div class="grupo">
                <label>Quantidade</label>
                <input type="number" id="quantidade" required placeholder="100">
            </div>

            <div class="grupo">
                <label>Estrat√©gia</label>
                <input type="text" id="estrategia" placeholder="Ex: Swing Trade">
            </div>

            <div class="grupo">
                <label>Setup</label>
                <textarea id="setup" placeholder="Descreva o setup..."></textarea>
            </div>

            <div class="grupo">
                <label>Emo√ß√µes</label>
                <textarea id="emocoes" placeholder="Como estava se sentindo?"></textarea>
            </div>

            <div class="grupo">
                <label>Observa√ß√µes</label>
                <textarea id="obs" placeholder="Li√ß√µes aprendidas..."></textarea>
            </div>

            <div class="botoes">
                <button type="button" class="btn btn-cancelar" onclick="fecharModal()">Cancelar</button>
                <button type="submit" class="btn btn-salvar">Salvar</button>
            </div>
        </form>
    </div>
</div>

<script>
// VARI√ÅVEIS GLOBAIS
var trades = [];
var entradasDCA = [{preco: '', quantidade: ''}];
var moedaAtual = '$';
var tradeEditando = null;

// INICIALIZA√á√ÉO
function carregar() {
    var dados = localStorage.getItem('trading-pro-trades');
    if (dados) {
        trades = JSON.parse(dados);
    }
    
    var moedaSalva = localStorage.getItem('trading-pro-moeda');
    if (moedaSalva) {
        moedaAtual = moedaSalva;
        document.getElementById('moeda-select').value = moedaAtual;
    }
    
    atualizar();
    renderizarEntradasDCA();
}

function salvar() {
    localStorage.setItem('trading-pro-trades', JSON.stringify(trades));
}

function mudarMoeda() {
    moedaAtual = document.getElementById('moeda-select').value;
    localStorage.setItem('trading-pro-moeda', moedaAtual);
    
    // Atualizar todos os s√≠mbolos de moeda na p√°gina
    document.getElementById('moeda-form1').textContent = moedaAtual;
    document.getElementById('moeda-form2').textContent = moedaAtual;
    document.getElementById('moeda-risco').textContent = moedaAtual;
    document.getElementById('moeda-risco2').textContent = moedaAtual;
    document.getElementById('moeda-dca').textContent = moedaAtual;
    
    atualizar();
}

// NAVEGA√á√ÉO
function mudarPagina(pagina) {
    var navItems = document.querySelectorAll('.nav-item');
    var pages = document.querySelectorAll('.page');
    
    for (var i = 0; i < navItems.length; i++) {
        navItems[i].classList.remove('active');
    }
    for (var i = 0; i < pages.length; i++) {
        pages[i].classList.remove('active');
    }
    
    event.target.closest('.nav-item').classList.add('active');
    document.getElementById('page-' + pagina).classList.add('active');
}

function mudarCalc(tipo) {
    var tabs = document.querySelectorAll('.tab-calc');
    for (var i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
    }
    event.target.classList.add('active');
    
    if (tipo === 'risco') {
        document.getElementById('calc-risco').classList.remove('oculto');
        document.getElementById('calc-dca').classList.add('oculto');
    } else {
        document.getElementById('calc-risco').classList.add('oculto');
        document.getElementById('calc-dca').classList.remove('oculto');
    }
}

// MODAL
function abrirModal() {
    tradeEditando = null;
    document.getElementById('modal').querySelector('h2').textContent = 'Novo Trade';
    document.getElementById('modal').classList.add('visivel');
}

function abrirModalEditar(id) {
    var trade = trades.find(function(t) { return t.id === id; });
    if (!trade) return;
    
    tradeEditando = id;
    document.getElementById('modal').querySelector('h2').textContent = 'Editar Trade';
    
    document.getElementById('ativo').value = trade.ativo;
    document.getElementById('tipo').value = trade.tipo;
    document.getElementById('dataEntrada').value = trade.dataEntrada;
    document.getElementById('dataSaida').value = trade.dataSaida;
    document.getElementById('precoEntrada').value = trade.precoEntrada;
    document.getElementById('precoSaida').value = trade.precoSaida;
    document.getElementById('quantidade').value = trade.quantidade;
    document.getElementById('estrategia').value = trade.estrategia || '';
    document.getElementById('setup').value = trade.setup || '';
    document.getElementById('emocoes').value = trade.emocoes || '';
    document.getElementById('obs').value = trade.obs || '';
    
    document.getElementById('modal').classList.add('visivel');
}

function fecharModal() {
    document.getElementById('modal').classList.remove('visivel');
    document.getElementById('formulario').reset();
    tradeEditando = null;
}

// FORMUL√ÅRIO
document.getElementById('formulario').onsubmit = function(e) {
    e.preventDefault();
    
    var entrada = parseFloat(document.getElementById('precoEntrada').value);
    var saida = parseFloat(document.getElementById('precoSaida').value);
    var qtd = parseFloat(document.getElementById('quantidade').value);
    var tipo = document.getElementById('tipo').value;
    
    var resultado = tipo === 'COMPRA' ? (saida - entrada) * qtd : (entrada - saida) * qtd;
    var percentual = tipo === 'COMPRA' ? ((saida - entrada) / entrada) * 100 : ((entrada - saida) / entrada) * 100;

    var tradeData = {
        ativo: document.getElementById('ativo').value.toUpperCase(),
        tipo: tipo,
        dataEntrada: document.getElementById('dataEntrada').value,
        dataSaida: document.getElementById('dataSaida').value,
        precoEntrada: entrada,
        precoSaida: saida,
        quantidade: qtd,
        estrategia: document.getElementById('estrategia').value,
        setup: document.getElementById('setup').value,
        emocoes: document.getElementById('emocoes').value,
        obs: document.getElementById('obs').value,
        resultado: resultado,
        percentual: percentual
    };

    if (tradeEditando) {
        // Editar trade existente
        var index = trades.findIndex(function(t) { return t.id === tradeEditando; });
        if (index !== -1) {
            tradeData.id = tradeEditando;
            trades[index] = tradeData;
        }
    } else {
        // Novo trade
        tradeData.id = Date.now();
        trades.push(tradeData);
    }

    salvar();
    atualizar();
    fecharModal();
};

function excluir(id) {
    if (confirm('Excluir este trade?')) {
        trades = trades.filter(function(t) { return t.id !== id; });
        salvar();
        atualizar();
    }
}

// ATUALIZA√á√ÉO
function atualizar() {
    atualizarGraficoMensal();
    atualizarStats();
    atualizarHistorico();
}

function atualizarGraficoMensal() {
    var container = document.getElementById('grafico-mes');
    
    if (trades.length === 0) {
        container.innerHTML = '';
        return;
    }
    
    var hoje = new Date();
    var mes = hoje.getMonth();
    var ano = hoje.getFullYear();
    
    var resultadosPorDia = {};
    for (var i = 0; i < trades.length; i++) {
        var data = new Date(trades[i].dataSaida);
        if (data.getMonth() === mes && data.getFullYear() === ano) {
            var dia = data.getDate();
            if (!resultadosPorDia[dia]) {
                resultadosPorDia[dia] = 0;
            }
            resultadosPorDia[dia] += trades[i].resultado;
        }
    }
    
    var totalMes = 0;
    for (var dia in resultadosPorDia) {
        totalMes += resultadosPorDia[dia];
    }
    
    var primeiroDia = new Date(ano, mes, 1);
    var ultimoDia = new Date(ano, mes + 1, 0);
    var totalDias = ultimoDia.getDate();
    
    var nomesMeses = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                      'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
    
    var html = '<div class="grafico-mensal">';
    html += '<div class="grafico-titulo">' + nomesMeses[mes] + ' ' + ano + '</div>';
    
    html += '<div class="calendario">';
    var diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
    for (var i = 0; i < 7; i++) {
        html += '<div class="dia-semana">' + diasSemana[i] + '</div>';
    }
    
    var primeiroDiaSemana = primeiroDia.getDay();
    for (var i = 0; i < primeiroDiaSemana; i++) {
        html += '<div class="dia dia-neutro"></div>';
    }
    
    for (var dia = 1; dia <= totalDias; dia++) {
        var valor = resultadosPorDia[dia] || 0;
        var classe = 'dia ';
        
        if (valor > 0) {
            classe += 'dia-positivo';
        } else if (valor < 0) {
            classe += 'dia-negativo';
        } else {
            classe += 'dia-neutro';
        }
        
        html += '<div class="' + classe + '">';
        html += '<div class="dia-numero">' + dia + '</div>';
        if (valor !== 0) {
            html += '<div class="dia-valor ' + (valor > 0 ? 'verde' : 'vermelho') + '">';
            html += (valor > 0 ? '+' : '') + valor.toFixed(0);
            html += '</div>';
        }
        html += '</div>';
    }
    
    html += '</div>';
    
    var totalSemana = 0;
    var dataHoje = hoje.getDate();
    for (var i = Math.max(1, dataHoje - 6); i <= dataHoje; i++) {
        if (resultadosPorDia[i]) {
            totalSemana += resultadosPorDia[i];
        }
    }
    
    html += '<div class="resumo-periodo">';
    html += '<div class="resumo-item">';
    html += '<div class="resumo-label">Total Semanal</div>';
    html += '<div class="resumo-valor ' + (totalSemana >= 0 ? 'verde' : 'vermelho') + '">' + moedaAtual + ' ' + totalSemana.toFixed(2) + '</div>';
    html += '</div>';
    html += '<div class="resumo-item">';
    html += '<div class="resumo-label">Total Mensal</div>';
    html += '<div class="resumo-valor ' + (totalMes >= 0 ? 'verde' : 'vermelho') + '">' + moedaAtual + ' ' + totalMes.toFixed(2) + '</div>';
    html += '</div>';
    html += '</div>';
    
    html += '</div>';
    
    container.innerHTML = html;
}

function atualizarStats() {
    var ganhos = [];
    var perdas = [];
    var total = 0;
    
    for (var i = 0; i < trades.length; i++) {
        if (trades[i].resultado > 0) {
            ganhos.push(trades[i]);
        } else {
            perdas.push(trades[i]);
        }
        total += trades[i].resultado;
    }
    
    var winRate = trades.length > 0 ? (ganhos.length / trades.length * 100) : 0;
    
    var somaGanhos = 0;
    for (var i = 0; i < ganhos.length; i++) {
        somaGanhos += ganhos[i].resultado;
    }
    var mediaGanho = ganhos.length > 0 ? somaGanhos / ganhos.length : 0;
    
    var somaPerdas = 0;
    for (var i = 0; i < perdas.length; i++) {
        somaPerdas += perdas[i].resultado;
    }
    var mediaPerda = perdas.length > 0 ? somaPerdas / perdas.length : 0;
    
    var payoff = mediaPerda !== 0 ? Math.abs(mediaGanho / mediaPerda) : 0;
    
    var melhor = 0;
    var pior = 0;
    if (trades.length > 0) {
        melhor = trades[0].resultado;
        pior = trades[0].resultado;
        for (var i = 1; i < trades.length; i++) {
            if (trades[i].resultado > melhor) melhor = trades[i].resultado;
            if (trades[i].resultado < pior) pior = trades[i].resultado;
        }
    }

    var html = '';
    
    html += '<div class="caixa">';
    html += '<div class="label">Lucro Total</div>';
    html += '<div class="valor ' + (total >= 0 ? 'verde' : 'vermelho') + '">' + moedaAtual + ' ' + total.toFixed(2) + '</div>';
    html += '</div>';
    
    html += '<div class="caixa">';
    html += '<div class="label">Win Rate</div>';
    html += '<div class="valor verde">' + winRate.toFixed(1) + '%</div>';
    html += '<div class="info">' + ganhos.length + ' vit√≥rias / ' + perdas.length + ' derrotas</div>';
    html += '</div>';
    
    html += '<div class="caixa">';
    html += '<div class="label">Payoff Ratio</div>';
    html += '<div class="valor verde">' + payoff.toFixed(2) + '</div>';
    html += '<div class="info">Ganho/Perda m√©dio</div>';
    html += '</div>';
    
    html += '<div class="caixa">';
    html += '<div class="label">Total de Trades</div>';
    html += '<div class="valor verde">' + trades.length + '</div>';
    html += '</div>';
    
    html += '<div class="caixa">';
    html += '<div class="label">Melhor Trade</div>';
    html += '<div class="valor verde">' + moedaAtual + ' ' + melhor.toFixed(2) + '</div>';
    html += '<div class="info">Ganho m√©dio: ' + moedaAtual + ' ' + mediaGanho.toFixed(2) + '</div>';
    html += '</div>';
    
    html += '<div class="caixa">';
    html += '<div class="label">Pior Trade</div>';
    html += '<div class="valor vermelho">' + moedaAtual + ' ' + pior.toFixed(2) + '</div>';
    html += '<div class="info">Perda m√©dia: ' + moedaAtual + ' ' + mediaPerda.toFixed(2) + '</div>';
    html += '</div>';
    
    document.getElementById('estatisticas').innerHTML = html;
}

function atualizarHistorico() {
    var lista = document.getElementById('lista-trades');
    
    if (trades.length === 0) {
        lista.innerHTML = '<div class="vazio">Nenhum trade registrado ainda.<br><br>Use o Journal para adicionar.</div>';
        return;
    }
    
    var ordenados = trades.slice().sort(function(a, b) {
        return new Date(b.dataSaida) - new Date(a.dataSaida);
    });
    
    var html = '';
    for (var i = 0; i < ordenados.length; i++) {
        var t = ordenados[i];
        html += '<div class="item-trade">';
        html += '<div class="trade-topo">';
        html += '<div class="ticker">' + t.ativo + '</div>';
        html += '<div class="resultado ' + (t.resultado >= 0 ? 'verde' : 'vermelho') + '">' + moedaAtual + ' ' + t.resultado.toFixed(2) + '</div>';
        html += '</div>';
        
        html += '<div class="info">';
        html += '<span class="tipo ' + (t.tipo === 'COMPRA' ? 'compra' : 'venda') + '">' + t.tipo + '</span>';
        html += new Date(t.dataSaida).toLocaleDateString('pt-BR');
        html += '</div>';
        
        html += '<div class="info">Entrada: ' + moedaAtual + ' ' + t.precoEntrada.toFixed(2) + ' ‚Ä¢ Sa√≠da: ' + moedaAtual + ' ' + t.precoSaida.toFixed(2) + '</div>';
        html += '<div class="info">Quantidade: ' + t.quantidade + ' ‚Ä¢ Resultado: ' + (t.percentual >= 0 ? '+' : '') + t.percentual.toFixed(2) + '%</div>';
        
        if (t.estrategia) html += '<div class="info">Estrat√©gia: ' + t.estrategia + '</div>';
        if (t.setup) html += '<div class="info">Setup: ' + t.setup + '</div>';
        if (t.emocoes) html += '<div class="info">Emo√ß√µes: ' + t.emocoes + '</div>';
        if (t.obs) html += '<div class="info">Obs: ' + t.obs + '</div>';
        
        html += '<button class="btn-editar" onclick="abrirModalEditar(' + t.id + ')">Editar</button>';
        html += '<button class="btn-excluir" onclick="excluir(' + t.id + ')">Excluir</button>';
        html += '</div>';
    }
    
    lista.innerHTML = html;
}

// CALCULADORA DE RISCO
function calcularRisco() {
    var capital = parseFloat(document.getElementById('capital').value) || 0;
    var riscoPercent = parseFloat(document.getElementById('risco-percent').value) || 0;
    var precoEntrada = parseFloat(document.getElementById('preco-entrada-risco').value) || 0;
    var stopLossPercent = parseFloat(document.getElementById('stop-loss-percent').value) || 0;
    var takeProfitPercent = parseFloat(document.getElementById('take-profit-percent').value) || 0;
    
    if (capital === 0 || riscoPercent === 0 || precoEntrada === 0 || stopLossPercent === 0) {
        document.getElementById('resultado-risco').innerHTML = '';
        return;
    }
    
    var valorRisco = capital * (riscoPercent / 100);
    var precoStop = precoEntrada * (1 - stopLossPercent / 100);
    var distanciaStop = Math.abs(precoEntrada - precoStop);
    var tamanhoPos = valorRisco / distanciaStop;
    var investimento = tamanhoPos * precoEntrada;
    var perdaMaxima = tamanhoPos * distanciaStop;
    
    var ganhoTP = 0;
    var rrRatio = 0;
    var precoTP = 0;
    if (takeProfitPercent > 0) {
        precoTP = precoEntrada * (1 + takeProfitPercent / 100);
        var distanciaTP = Math.abs(precoTP - precoEntrada);
        ganhoTP = tamanhoPos * distanciaTP;
        rrRatio = distanciaTP / distanciaStop;
    }
    
    var html = '<div class="calc-resultado">';
    
    html += '<div class="calc-item">';
    html += '<div class="calc-label">Pre√ßo Stop Loss</div>';
    html += '<div class="calc-valor vermelho">' + moedaAtual + ' ' + precoStop.toFixed(2) + '</div>';
    html += '</div>';
    
    if (takeProfitPercent > 0) {
        html += '<div class="calc-item">';
        html += '<div class="calc-label">Pre√ßo Take Profit</div>';
        html += '<div class="calc-valor verde">' + moedaAtual + ' ' + precoTP.toFixed(2) + '</div>';
        html += '</div>';
    }
    
    html += '<div class="calc-item">';
    html += '<div class="calc-label">Tamanho da Posi√ß√£o</div>';
    html += '<div class="calc-valor">' + tamanhoPos.toFixed(0) + ' a√ß√µes</div>';
    html += '</div>';
    
    html += '<div class="calc-item">';
    html += '<div class="calc-label">Investimento Total</div>';
    html += '<div class="calc-valor">' + moedaAtual + ' ' + investimento.toFixed(2) + '</div>';
    html += '</div>';
    
    html += '<div class="calc-item">';
    html += '<div class="calc-label">Perda M√°xima (Stop)</div>';
    html += '<div class="calc-valor vermelho">' + moedaAtual + ' ' + perdaMaxima.toFixed(2) + '</div>';
    html += '</div>';
    
    if (takeProfitPercent > 0) {
        html += '<div class="calc-item">';
        html += '<div class="calc-label">Ganho Potencial (TP)</div>';
        html += '<div class="calc-valor verde">' + moedaAtual + ' ' + ganhoTP.toFixed(2) + '</div>';
        html += '</div>';
        
        html += '<div class="calc-item">';
        html += '<div class="calc-label">R:R Ratio</div>';
        html += '<div class="calc-valor azul">1:' + rrRatio.toFixed(2) + '</div>';
        html += '</div>';
    }
    
    html += '</div>';
    
    document.getElementById('resultado-risco').innerHTML = html;
}

// CALCULADORA DCA
function adicionarEntradaDCA() {
    entradasDCA.push({preco: '', quantidade: ''});
    renderizarEntradasDCA();
}

function removerEntradaDCA(index) {
    if (entradasDCA.length > 1) {
        entradasDCA.splice(index, 1);
        renderizarEntradasDCA();
        calcularDCA();
    }
}

function renderizarEntradasDCA() {
    var container = document.getElementById('entradas-dca');
    var html = '';
    
    for (var i = 0; i < entradasDCA.length; i++) {
        html += '<div class="dca-entrada">';
        html += '<div class="dca-entrada-header">';
        html += '<div class="entrada-numero">Entrada ' + (i + 1) + '</div>';
        if (entradasDCA.length > 1) {
            html += '<button class="btn-remover" onclick="removerEntradaDCA(' + i + ')">Remover</button>';
        }
        html += '</div>';
        
        html += '<div class="grupo">';
        html += '<label>Pre√ßo (' + moedaAtual + ')</label>';
        html += '<input type="number" step="0.01" id="dca-preco-' + i + '" placeholder="50.00" oninput="atualizarEntradaDCA(' + i + ')">';
        html += '</div>';
        
        html += '<div class="grupo">';
        html += '<label>Quantidade</label>';
        html += '<input type="number" id="dca-qtd-' + i + '" placeholder="100" oninput="atualizarEntradaDCA(' + i + ')">';
        html += '</div>';
        html += '</div>';
    }
    
    container.innerHTML = html;
    
    for (var i = 0; i < entradasDCA.length; i++) {
        if (entradasDCA[i].preco) {
            document.getElementById('dca-preco-' + i).value = entradasDCA[i].preco;
        }
        if (entradasDCA[i].quantidade) {
            document.getElementById('dca-qtd-' + i).value = entradasDCA[i].quantidade;
        }
    }
}

function atualizarEntradaDCA(index) {
    entradasDCA[index].preco = document.getElementById('dca-preco-' + index).value;
    entradasDCA[index].quantidade = document.getElementById('dca-qtd-' + index).value;
    calcularDCA();
}

function calcularDCA() {
    var totalInvestido = 0;
    var totalAcoes = 0;
    var entradasValidas = 0;
    
    for (var i = 0; i < entradasDCA.length; i++) {
        var preco = parseFloat(entradasDCA[i].preco) || 0;
        var qtd = parseFloat(entradasDCA[i].quantidade) || 0;
        
        if (preco > 0 && qtd > 0) {
            totalInvestido += preco * qtd;
            totalAcoes += qtd;
            entradasValidas++;
        }
    }
    
    if (entradasValidas === 0) {
        document.getElementById('resultado-dca').innerHTML = '';
        return;
    }
    
    var precoMedio = totalInvestido / totalAcoes;
    var precoAlvo = parseFloat(document.getElementById('preco-alvo').value) || 0;
    
    var html = '<div class="calc-resultado">';
    
    html += '<div class="calc-item">';
    html += '<div class="calc-label">Total Investido</div>';
    html += '<div class="calc-valor">' + moedaAtual + ' ' + totalInvestido.toFixed(2) + '</div>';
    html += '</div>';
    
    html += '<div class="calc-item">';
    html += '<div class="calc-label">Total de A√ß√µes</div>';
    html += '<div class="calc-valor">' + totalAcoes.toFixed(0) + '</div>';
    html += '</div>';
    
    html += '<div class="calc-item">';
    html += '<div class="calc-label">Pre√ßo M√©dio</div>';
    html += '<div class="calc-valor verde">' + moedaAtual + ' ' + precoMedio.toFixed(2) + '</div>';
    html += '</div>';
    
    if (precoAlvo > 0 && precoAlvo !== precoMedio) {
        var acoesNecessarias = (totalInvestido - (precoAlvo * totalAcoes)) / (precoAlvo - precoMedio);
        var investimentoNecessario = acoesNecessarias * precoAlvo;
        
        if (acoesNecessarias > 0) {
            html += '<div class="calc-item">';
            html += '<div class="calc-label">A√ß√µes para ' + moedaAtual + ' ' + precoAlvo.toFixed(2) + '</div>';
            html += '<div class="calc-valor azul">' + Math.abs(acoesNecessarias).toFixed(0) + ' a√ß√µes</div>';
            html += '</div>';
            
            html += '<div class="calc-item">';
            html += '<div class="calc-label">Investimento Necess√°rio</div>';
            html += '<div class="calc-valor">' + moedaAtual + ' ' + Math.abs(investimentoNecessario).toFixed(2) + '</div>';
            html += '</div>';
        }
    }
    
    html += '</div>';
    
    document.getElementById('resultado-dca').innerHTML = html;
}

// Registrar Service Worker para PWA
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js').catch(function() {
            console.log('SW registration failed');
        });
    });
}

carregar();
</script>

</body>
</html>